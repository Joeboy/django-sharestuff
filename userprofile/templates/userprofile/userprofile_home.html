{% extends 'base.html' %}

{% block extrahead %}{{block.super}}
    <link href="http://www.google.com/uds/css/gsearch.css" type="text/css" rel="stylesheet" />
    <link rel="stylesheet" href="http://www.google.com/uds/solutions/localsearch/gmlocalsearch.css" />
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAA0okLrKZhiNabzBlBE2rJHRQRB3d2m0eE07bem--pb7XcM7LibBS3sJZUsLLOaucwIRuf8Q4305bVSw" type="text/javascript"></script>
    <script src="/media/js/pickup-points.js" type="text/javascript"></script>

{% endblock %}

{% block content %}
<h2>{{user.username}}'s profile</h2>

{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}

{% with user.get_profile.offer_set.live.count as live_offer_count %}
    <p>You are currently offering {{ live_offer_count }} item{{ live_offer_count|pluralize }}. <a href="{% url my_offers %}">View/edit your offers</a>.</p>
{% endwith %}

<p>View your <a href="{% url user_details user.username %}">public profile</a>.</p>

<h4>Contact details</h4>

{% if userprofile_form.errors %}
    {{ userprofile_form.errors.as_ul }}
{% endif %}

<form action="" method="post" id="userprofile_form">{% csrf_token %}
  <fieldset>
    <p><label for="id_email">Email:</label>{{ userprofile_form.email }}</p>
    <p><label for="id_phone_number">Phone number:</label>{{ userprofile_form.phone_number }}</p>

    <h4>Location</h4>
    {% if user.get_profile.latitude %}
        <p>The map below indicates your location. To change your location drag the marker to your preferred location.</p>
    {% else %}
        <p>In order to allow you to find other people's items, and to allow other people to find your items, please place a marker on the map and drag it to your location.</p>
    {% endif %}

    <div style="display:none;border:1px solid #f0f;">
        {{userprofile_form.longitude}}
        {{userprofile_form.latitude}}
    </div>

    <div id="map_canvas" style="width: 300px; height: 300px"></div>
  </fieldset>

<input type="submit" value="Update">
</form>
{% endblock %}
